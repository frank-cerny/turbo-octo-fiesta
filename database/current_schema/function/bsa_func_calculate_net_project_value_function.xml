<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog 
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:n0="http://www.oracle.com/xml/ns/dbchangelog-ext" 
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog 
	http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.9.xsd">
	<changeSet id="2efb967717a445405c8abf7da34b4527cff312c9" author="(FCERNY)-Generated" failOnError="false"    >
		<n0:createOracleFunction objectName="BSA_FUNC_CALCULATE_NET_PROJECT_VALUE" objectType="FUNCTION" ownerName="FCERNY"   >
			<n0:source><![CDATA[
  CREATE OR REPLACE EDITIONABLE FUNCTION "FCERNY"."BSA_FUNC_CALCULATE_NET_PROJECT_VALUE" (projectId IN int) 
RETURN number 
AS 
    bikeCost number; 
    toolCost number; 
    singleUseSupplyCost number; 
    fixedSupplyCost number; 
    nonFixedSupplyCost number; 
    revenue number; 
    BEGIN 
        -- APEX_DEBUG.ENABLE(apex_debug.c_log_level_engine_trace); 
        SELECT sum(purchaseprice) into bikeCost from bsa_bike where project_id = projectId; 
        SELECT sum(costbasis) into toolCost FROM bsa_view_project_tool WHERE project_id = projectId; 
        SELECT sum(unitcost*unitspurchased) into singleUseSupplyCost from bsa_single_use_supply where project_id = projectId; 
        SELECT sum(costbasis) into fixedSupplyCost FROM bsa_view_project_fixed_supply WHERE project_id = projectId; 
        SELECT sum(costbasis) into nonFixedSupplyCost FROM bsa_view_project_non_fixed_supply WHERE project_id = projectId; 
        SELECT sum(saleprice) into revenue FROM bsa_revenue_item WHERE project_id = projectId; 
        -- Check for any null values 
        if bikeCost is NULL then 
            bikeCost := 0; 
        end if; 
        if toolCost is NULL then 
            toolCost := 0; 
        end if; 
        if singleUseSupplyCost is NULL then 
            singleUseSupplyCost := 0; 
        end if; 
        if fixedSupplyCost is NULL then 
            fixedSupplyCost := 0; 
        end if; 
        if nonFixedSupplyCost is NULL then 
            nonFixedSupplyCost := 0; 
        end if; 
        if revenue is NULL then 
            revenue := 0; 
        end if; 
        -- apex_debug.info('Bike Purchase Price: ' || bikeCost); 
        -- apex_debug.info('Tool Cost: ' || toolCost); 
        -- apex_debug.info('Single Use Supply Cost: ' || singleUseSupplyCost); 
        -- apex_debug.info('Fixed Supply Cost: ' || fixedSupplyCost); 
        -- apex_debug.info('Non Fixed Supply Cost: ' || nonFixedSupplyCost); 
        -- apex_debug.info('Revenue: ' || revenue); 
        -- Setting the out value is the same as "returning a value" 
        return  (revenue - bikeCost - toolCost - singleUseSupplyCost - fixedSupplyCost - nonFixedSupplyCost); 
    END; 
/]]></n0:source>
		</n0:createOracleFunction>
	</changeSet>
</databaseChangeLog>
